<!DOCTYPE html>
<html>

<head>
    <title>List Page</title>
</head>

<body>
    <h1>List Page</h1>
    <!-- <a href='/insert'>Insert Data</a> -->
    <hr>

    <!-- name이 또 중복되면 안됨;;
    <form action="/delete" method="post">
        id : <input type="text" name="id"><br>
        <input type="submit" value="Delete">
    </form>
    <hr> -->


    <form action="/post" method="post">
        task : <input type="text" name="task" id="task"><br>
        due_date : <input type="datetime-local" name="due_date"><br>
        priority : <input type="range" min="0" max="10" name="priority"><br>
    </form>
    <button class="ajax">Ajax</button>
    <div class="result"></div>
    <button class="delete" id="delete">Delete</button>
    <hr>

    <form action="/post" method="post">
        <table width="100%" border="1">
            <tr>
                <th>Num</th>
                <th>Task</th>
                <th>Due Date</th>
                <th>Priority</th>
                <th>Status</th>
                <th>Box</th>
            </tr>
            <% prodList.forEach(function(item, index){ %>
            <tr>
                <!-- <td><a href='/delete/<%= item.id %>' >DELETE</a></td>
            <td><a href='/edit/<%= item.id %>' >EDIT</a></td> -->
                <td><%= item.id %></td>
                <td><%= item.task %></td>
                <td><%= item.due_date %></td>
                <td><%= item.priority %></td>
                <td><%= item.status %></td>
                <td> <input type="checkbox" name="delete" value="<%= item.id %>"> </td>
            </tr>
            <% }); %>
        </table>
    </form>

    <script src="/api/ajax.js"></script>
    <!-- <script>
        const mariadb = require('mariadb');
        const pool = mariadb.createPool({
            host: '192.168.1.70',
            port: 5507,
            user: 'ejkim',
            password: 'ejkim',
            database: 'my_todo'
        });


        document.querySelector('.delete').addEventListener('click', function () {
            var deleteElements = document.getElementsByName("delete");

            var url = 'http://192.168.1.70:3001/delete';

            deleteElements.forEach(function (item, index) {
                if (item.checked) {
                    console.log(item.value);

                    pool.getConnection()
                        .then (conn => {
                            console.log("Connect MariaDB!")
                            conn.query("UPDATE todo_table SET del_flag=1 where id=3");
                            })
                        .catch(err => {
                            console.log(err)
                        })
                }
            });

            var xhr = new XMLHttpRequest();
            xhr.open('GET', url)
            xhr.setRequestHeader('Content-Type', 'application/json');
            xhr.send(deleteElements)
        })


    </script> -->

</body>

</html>